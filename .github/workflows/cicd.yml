name: Talent Academy Demo
on: [ push ]    # List on one line
jobs:
  terraform-deployment:
    runs-on: ubuntu-latest
    steps: # The list of steps to take for executionnn
      - name: Authenticate with AWS
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: eu-west-1

      - name: Clone your code in the pipeline
        uses: actions/checkout@v2

      # - name: Install SSH KEY
      #   uses: shimataro/ssh-key-action@v2
      #   with:
      #     key: ${{ secrets.SSH_PRIVATE_KEY }}
      #     known_hosts: 'just-a-placeholder-so-we-dont-get-errors'
      #     name: ta-lab-key

      # - name: executing remote ssh commands using ssh key
      #   uses: appleboy/ssh-action@v0.1.4
      #   with:
      #     host: 34.243.23.80
      #     username: ubuntu
      #     key: ${{ secrets.SSH_PRIVATE_KEY }}
      #     port: 22

      - name: connection via ssh check
        uses: fifsky/ssh-action@master
        with:
          command: |
            cd /tmp
            ls -a
          host: 34.243.23.80
          user: ubuntu
          key: ${{ secrets.SSH_PRIVATE_KEY}}

      # - name: Create SSH key
      #   run: |
      #     mkdir -p ~/.ssh/
      #     echo "$SSH_PRIVATE_KEY" > ../private.key
      #     sudo chmod 600 ../private.key
      #     echo "$SSH_KNOWN_HOSTS" > ~/.ssh/known_hosts
      #   shell: bash
      #   env:
      #     SSH_PRIVATE_KEY: ${{secrets.SSH_PRIVATE_KEY}}
      #     SSH_KNOWN_HOSTS: ${{secrets.SSH_KNOWN_HOSTS}}
      #     SSH_KEY_PATH: ${{ github.workspace }}/../private.key
          

      # - name: Adding Known Hosts
      #   run: ssh-keyscan -H ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts


      
      # - name: Run playbook to configure nginx 
      #   id: run_playbook
      #   run: ansible-playbook playbook.yml 
      #   continue-on-error: true
